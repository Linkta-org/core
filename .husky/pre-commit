#npm run text 

#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "â”â”â”â” ğŸ› ï¸  Running TypeScript compiler checks â”â”â”â”â”â”â”"

# Run TypeScript compiler in noEmit mode to check for errors in client and server
echo "ğŸ“ Checking TypeScript in ./client"
npx --prefix ./client tsc --noEmit --project ./client/tsconfig.json
CLIENT_TSC=$?


echo "ğŸ“ Checking TypeScript in ./server"
npx --prefix ./server tsc --noEmit --project ./server/tsconfig.json
SERVER_TSC=$?

if [ $CLIENT_TSC -ne 0 ] || [ $SERVER_TSC -ne 0 ]; then
  echo "âŒ TypeScript errors detected. Commit aborted."
  exit 1
fi

echo "âœ… TypeScript checks passed"

echo "â”â”â”â” ğŸ•µï¸â€â™€ï¸  Running lint-staged â”â”â”â”â”â”â”"

# Run lint-staged in client and server directories
echo "ğŸ“ Linting and formatting in ./client"
npx lint-staged --cwd ./client
CLIENT_LINT=$?

echo "ğŸ“ Linting and formatting in ./server"
npx lint-staged --cwd ./server
SERVER_LINT=$?

if [ $CLIENT_LINT -ne 0 ] || [ $SERVER_LINT -ne 0 ]; then
  echo "âŒ Linting errors detected. Commit aborted."
  exit 1
fi

echo "âœ… Linting and formatting passed. Ready to commit."
